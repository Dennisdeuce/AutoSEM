<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AutoSEM ‚Äî Court Sportswear Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=IBM+Plex+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #05080f;
  --surface: #0d1117;
  --surface2: #161b22;
  --border: #21262d;
  --text: #e6edf3;
  --dim: #7d8590;
  --green: #3fb950;
  --green-bg: rgba(63,185,80,0.1);
  --red: #f85149;
  --red-bg: rgba(248,81,73,0.1);
  --amber: #d29922;
  --amber-bg: rgba(210,153,34,0.1);
  --blue: #58a6ff;
  --blue-bg: rgba(88,166,255,0.1);
  --purple: #bc8cff;
  --purple-bg: rgba(188,140,255,0.1);
}
* { margin:0; padding:0; box-sizing:border-box; }
body { background:var(--bg); color:var(--text); font-family:'Space Grotesk',sans-serif; line-height:1.6; }
.wrap { max-width:1200px; margin:0 auto; padding:24px; }

/* Header */
.hdr { display:flex; justify-content:space-between; align-items:center; padding-bottom:20px; border-bottom:1px solid var(--border); margin-bottom:24px; flex-wrap:wrap; gap:12px; }
.hdr h1 { font-size:22px; font-weight:700; letter-spacing:-0.5px; }
.hdr h1 span { color:var(--blue); }
.hdr-right { display:flex; align-items:center; gap:16px; }
.hdr-pill { font-family:'IBM Plex Mono'; font-size:11px; padding:4px 12px; border-radius:20px; display:flex; align-items:center; gap:6px; }
.hdr-pill.live { background:var(--green-bg); color:var(--green); }
.hdr-pill.ver { background:var(--blue-bg); color:var(--blue); }
.hdr-pill .dot { width:6px; height:6px; border-radius:50%; background:var(--green); animation:pulse 2s infinite; }
@keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.3} }
#lastUpdate { font-family:'IBM Plex Mono'; font-size:11px; color:var(--dim); }

/* Tabs */
.tabs { display:flex; gap:4px; margin-bottom:24px; border-bottom:1px solid var(--border); padding-bottom:0; }
.tab { padding:10px 20px; font-size:13px; font-weight:600; color:var(--dim); cursor:pointer; border-bottom:2px solid transparent; transition:all 0.2s; }
.tab:hover { color:var(--text); }
.tab.active { color:var(--blue); border-bottom-color:var(--blue); }
.tab-panel { display:none; }
.tab-panel.active { display:block; }

/* Cards */
.grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:14px; margin-bottom:20px; }
.card { background:var(--surface); border:1px solid var(--border); border-radius:12px; padding:18px; }
.card .lbl { font-size:11px; text-transform:uppercase; letter-spacing:0.5px; color:var(--dim); margin-bottom:6px; }
.card .val { font-family:'IBM Plex Mono'; font-size:26px; font-weight:700; letter-spacing:-0.5px; }
.card .note { font-size:11px; color:var(--dim); margin-top:4px; }
.g { color:var(--green); } .r { color:var(--red); } .a { color:var(--amber); } .b { color:var(--blue); }

/* Table */
.tbl { width:100%; border-collapse:collapse; font-size:13px; background:var(--surface); border-radius:12px; overflow:hidden; margin-bottom:20px; }
.tbl th { text-align:left; padding:10px 14px; font-size:11px; text-transform:uppercase; letter-spacing:0.5px; color:var(--dim); border-bottom:1px solid var(--border); font-weight:500; }
.tbl td { padding:10px 14px; border-bottom:1px solid var(--border); }
.tbl tr:last-child td { border-bottom:none; }
.mono { font-family:'IBM Plex Mono'; font-weight:500; }

/* Insight */
.ins { background:var(--surface); border-left:3px solid var(--blue); border-radius:0 12px 12px 0; padding:14px 18px; margin-bottom:14px; font-size:14px; line-height:1.7; }
.ins.warn { border-left-color:var(--amber); }
.ins.crit { border-left-color:var(--red); }
.ins.good { border-left-color:var(--green); }

/* Progress */
.prog { display:flex; align-items:center; gap:12px; margin-bottom:8px; }
.prog-lbl { width:130px; flex-shrink:0; font-size:13px; color:var(--dim); text-align:right; }
.prog-track { flex:1; height:22px; background:var(--surface2); border-radius:6px; overflow:hidden; }
.prog-fill { height:100%; border-radius:6px; display:flex; align-items:center; padding:0 10px; font-family:'IBM Plex Mono'; font-size:11px; font-weight:500; transition:width 0.8s ease; }

/* Check items */
.chk { display:flex; align-items:flex-start; gap:10px; padding:10px 14px; border-bottom:1px solid var(--border); font-size:13px; }
.chk:last-child { border-bottom:none; }
.chk .ic { font-size:14px; flex-shrink:0; }

/* Loading */
.loading { text-align:center; padding:40px; color:var(--dim); }
.loading::after { content:''; display:inline-block; width:16px; height:16px; border:2px solid var(--border); border-top-color:var(--blue); border-radius:50%; animation:spin 0.8s linear infinite; margin-left:8px; vertical-align:middle; }
@keyframes spin { to{transform:rotate(360deg)} }

/* Error */
.err-banner { background:var(--red-bg); border:1px solid rgba(248,81,73,0.3); border-radius:10px; padding:12px 16px; margin-bottom:16px; font-size:13px; color:var(--red); display:none; }

@media(max-width:700px) { .grid{grid-template-columns:1fr 1fr;} .tabs{overflow-x:auto;} }
</style>
</head>
<body>
<div class="wrap">

<!-- HEADER -->
<div class="hdr">
  <h1>Auto<span>SEM</span> ‚Äî Court Sportswear</h1>
  <div class="hdr-right">
    <div class="hdr-pill live"><span class="dot"></span> <span id="healthStatus">Connecting...</span></div>
    <div class="hdr-pill ver" id="versionPill">v--</div>
    <span id="lastUpdate">‚Äî</span>
  </div>
</div>

<div class="err-banner" id="errBanner"></div>

<!-- TABS -->
<div class="tabs">
  <div class="tab active" data-tab="overview">Overview</div>
  <div class="tab" data-tab="meta">Meta Ads</div>
  <div class="tab" data-tab="shopify">Shopify</div>
  <div class="tab" data-tab="seo">SEO & Content</div>
  <div class="tab" data-tab="tasks">Task Tracker</div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê OVERVIEW TAB ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="tab-panel active" id="panel-overview">
  <div class="grid" id="overviewCards">
    <div class="card"><div class="lbl">Meta Spend (7d)</div><div class="val b" id="ov-spend">‚Äî</div><div class="note" id="ov-spend-note"></div></div>
    <div class="card"><div class="lbl">Meta Clicks</div><div class="val g" id="ov-clicks">‚Äî</div><div class="note" id="ov-clicks-note"></div></div>
    <div class="card"><div class="lbl">Avg CTR</div><div class="val g" id="ov-ctr">‚Äî</div><div class="note">Industry avg: 0.9%</div></div>
    <div class="card"><div class="lbl">Avg CPC</div><div class="val g" id="ov-cpc">‚Äî</div><div class="note" id="ov-cpc-note"></div></div>
  </div>
  <div class="grid">
    <div class="card"><div class="lbl">Products</div><div class="val" id="ov-products">‚Äî</div><div class="note" id="ov-products-note"></div></div>
    <div class="card"><div class="lbl">Collections</div><div class="val" id="ov-collections">‚Äî</div><div class="note" id="ov-collections-note"></div></div>
    <div class="card"><div class="lbl">Blog Posts</div><div class="val b" id="ov-blogs">‚Äî</div><div class="note">SEO content</div></div>
    <div class="card"><div class="lbl">Shopify Token</div><div class="val" id="ov-token">‚Äî</div><div class="note" id="ov-token-note"></div></div>
  </div>

  <div style="font-size:15px;font-weight:600;margin:20px 0 12px;color:var(--dim)">Optimization Progress</div>
  <div id="overviewProgress">
    <div class="prog"><div class="prog-lbl">Overall</div><div class="prog-track"><div class="prog-fill" id="prog-overall" style="width:0%;background:rgba(63,185,80,0.6)"></div></div></div>
    <div class="prog"><div class="prog-lbl">Product SEO</div><div class="prog-track"><div class="prog-fill" id="prog-products" style="width:0%;background:rgba(63,185,80,0.6)"></div></div></div>
    <div class="prog"><div class="prog-lbl">Meta Ads</div><div class="prog-track"><div class="prog-fill" id="prog-meta" style="width:0%;background:rgba(63,185,80,0.6)"></div></div></div>
    <div class="prog"><div class="prog-lbl">Email Marketing</div><div class="prog-track"><div class="prog-fill" id="prog-email" style="width:0%;background:rgba(210,153,34,0.5)"></div></div></div>
    <div class="prog"><div class="prog-lbl">Technical SEO</div><div class="prog-track"><div class="prog-fill" id="prog-tech" style="width:0%;background:rgba(88,166,255,0.5)"></div></div></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê META ADS TAB ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="tab-panel" id="panel-meta">
  <div class="grid" id="metaCards">
    <div class="card"><div class="lbl">Total Spend</div><div class="val b" id="m-spend">‚Äî</div></div>
    <div class="card"><div class="lbl">Impressions</div><div class="val" id="m-impressions">‚Äî</div></div>
    <div class="card"><div class="lbl">Reach</div><div class="val" id="m-reach">‚Äî</div></div>
    <div class="card"><div class="lbl">Clicks</div><div class="val g" id="m-clicks">‚Äî</div></div>
    <div class="card"><div class="lbl">Avg CTR</div><div class="val g" id="m-ctr">‚Äî</div></div>
    <div class="card"><div class="lbl">Avg CPC</div><div class="val g" id="m-cpc">‚Äî</div></div>
  </div>

  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
    <span style="font-size:15px;font-weight:600;color:var(--dim)">Campaigns</span>
    <button onclick="syncMeta()" style="background:var(--blue-bg);color:var(--blue);border:1px solid rgba(88,166,255,0.3);padding:6px 14px;border-radius:8px;font-size:12px;font-family:inherit;cursor:pointer">‚Üª Sync Now</button>
  </div>
  <table class="tbl" id="metaTable">
    <thead><tr><th>Campaign</th><th>Status</th><th>Spend</th><th>Clicks</th><th>CTR</th><th>CPC</th><th>Signal</th></tr></thead>
    <tbody id="metaRows"><tr><td colspan="7" class="loading">Loading Meta data</td></tr></tbody>
  </table>
  <div class="ins" id="metaInsight" style="display:none"></div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SHOPIFY TAB ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="tab-panel" id="panel-shopify">
  <div class="grid" id="shopifyCards">
    <div class="card"><div class="lbl">Store Status</div><div class="val" id="sh-status">‚Äî</div><div class="note" id="sh-store"></div></div>
    <div class="card"><div class="lbl">Active Products</div><div class="val" id="sh-products">‚Äî</div><div class="note" id="sh-products-note"></div></div>
    <div class="card"><div class="lbl">Collections</div><div class="val" id="sh-collections">‚Äî</div><div class="note" id="sh-collections-note"></div></div>
    <div class="card"><div class="lbl">Token Expires</div><div class="val" id="sh-token">‚Äî</div><div class="note" id="sh-token-note">Auto-refresh enabled</div></div>
  </div>

  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
    <span style="font-size:15px;font-weight:600;color:var(--dim)">Products</span>
    <button onclick="refreshToken()" style="background:var(--purple-bg);color:var(--purple);border:1px solid rgba(188,140,255,0.3);padding:6px 14px;border-radius:8px;font-size:12px;font-family:inherit;cursor:pointer">‚Üª Refresh Token</button>
  </div>
  <table class="tbl">
    <thead><tr><th>Product</th><th>Price</th><th>Description</th><th>SEO</th></tr></thead>
    <tbody id="shopifyRows"><tr><td colspan="4" class="loading">Loading Shopify data</td></tr></tbody>
  </table>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SEO TAB ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="tab-panel" id="panel-seo">
  <div class="grid">
    <div class="card"><div class="lbl">CRO Descriptions</div><div class="val g" id="seo-cro">‚Äî</div><div class="note">Target: 400+ chars</div></div>
    <div class="card"><div class="lbl">SEO Meta Tags</div><div class="val g" id="seo-meta">‚Äî</div><div class="note">Title + description</div></div>
    <div class="card"><div class="lbl">Blog Posts</div><div class="val b" id="seo-blogs">‚Äî</div><div class="note">Organic traffic drivers</div></div>
    <div class="card"><div class="lbl">Image Alt Tags</div><div class="val g" id="seo-alt">‚úì</div><div class="note">All images have alt text</div></div>
  </div>

  <div style="font-size:15px;font-weight:600;margin:8px 0 12px;color:var(--dim)">Blog Posts</div>
  <table class="tbl">
    <thead><tr><th>Title</th><th>Published</th><th>Tags</th></tr></thead>
    <tbody id="blogRows"><tr><td colspan="3" class="loading">Loading blog data</td></tr></tbody>
  </table>

  <div style="font-size:15px;font-weight:600;margin:20px 0 12px;color:var(--dim)">Technical SEO Status</div>
  <div style="background:var(--surface);border-radius:12px;overflow:hidden" id="techSeoChecks">
    <div class="chk"><span class="ic">‚úÖ</span> Sitemap.xml ‚Äî auto-generated by Shopify</div>
    <div class="chk"><span class="ic">‚úÖ</span> Robots.txt ‚Äî properly configured</div>
    <div class="chk"><span class="ic">‚úÖ</span> Canonical URLs on all pages</div>
    <div class="chk"><span class="ic">‚úÖ</span> Open Graph tags (title, desc, image)</div>
    <div class="chk"><span class="ic">‚úÖ</span> Meta descriptions on all products</div>
    <div class="chk"><span class="ic">‚úÖ</span> SSL/HTTPS active</div>
    <div class="chk"><span class="ic">‚úÖ</span> Blog JSON-LD Article schema</div>
    <div class="chk"><span class="ic">‚ö†Ô∏è</span> <strong>No JSON-LD Product schema</strong> ‚Äî Google rich results (price, stars) won't display</div>
    <div class="chk"><span class="ic">‚ö†Ô∏è</span> <strong>Generic URL handles</strong> ‚Äî /products/mens-performance-crew-neck-tennis-t-shirt-5</div>
    <div class="chk"><span class="ic">‚ö†Ô∏è</span> <strong>Collection page 1.3MB</strong> ‚Äî 243 images, needs lazy loading</div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TASKS TAB ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="tab-panel" id="panel-tasks">
  <div style="font-size:15px;font-weight:600;margin-bottom:12px;color:var(--green)">‚úÖ Completed (18)</div>
  <div style="background:var(--surface);border-radius:12px;overflow:hidden;margin-bottom:20px">
    <div class="chk"><span class="ic">‚úÖ</span> Pause all TikTok campaigns (19/19)</div>
    <div class="chk"><span class="ic">‚úÖ</span> Install Judge.me reviews</div>
    <div class="chk"><span class="ic">‚úÖ</span> Free shipping announcement bar</div>
    <div class="chk"><span class="ic">‚úÖ</span> Deep-link Meta ads to collection pages</div>
    <div class="chk"><span class="ic">‚úÖ</span> Scale Meta budget to $15/day</div>
    <div class="chk"><span class="ic">‚úÖ</span> Reactivate Meta campaign</div>
    <div class="chk"><span class="ic">‚úÖ</span> CRO descriptions on 23/23 products</div>
    <div class="chk"><span class="ic">‚úÖ</span> SEO meta tags on 23/23 products</div>
    <div class="chk"><span class="ic">‚úÖ</span> 4 Tennis Pilsner products optimized</div>
    <div class="chk"><span class="ic">‚úÖ</span> Beer &amp; Tennis collection (12 products)</div>
    <div class="chk"><span class="ic">‚úÖ</span> Retro Gaming collection (3 products)</div>
    <div class="chk"><span class="ic">‚úÖ</span> Navigation expanded (8 items)</div>
    <div class="chk"><span class="ic">‚úÖ</span> Footer menu (10 items)</div>
    <div class="chk"><span class="ic">‚úÖ</span> About, FAQ, Size Guide, Shipping pages</div>
    <div class="chk"><span class="ic">‚úÖ</span> 6 SEO blog posts published</div>
    <div class="chk"><span class="ic">‚úÖ</span> AutoSEM Shopify router built</div>
    <div class="chk"><span class="ic">‚úÖ</span> Shopify token auto-refresh</div>
    <div class="chk"><span class="ic">‚úÖ</span> Shopify API authentication resolved</div>
  </div>

  <div style="font-size:15px;font-weight:600;margin-bottom:12px;color:var(--amber)">üîÑ In Progress (3)</div>
  <div style="background:var(--surface);border-radius:12px;overflow:hidden;margin-bottom:20px">
    <div class="chk"><span class="ic">üîÑ</span> <strong>Klaviyo email capture popup</strong> ‚Äî form config in Klaviyo dashboard</div>
    <div class="chk"><span class="ic">üîÑ</span> <strong>Abandoned cart flow</strong> ‚Äî 3-email Klaviyo sequence</div>
    <div class="chk"><span class="ic">üîÑ</span> <strong>Deploy AutoSEM v1.3.0</strong> ‚Äî Shopify router + deploy.py fix</div>
  </div>

  <div style="font-size:15px;font-weight:600;margin-bottom:12px;color:var(--dim)">üìã Backlog (2)</div>
  <div style="background:var(--surface);border-radius:12px;overflow:hidden;margin-bottom:20px">
    <div class="chk"><span class="ic">üìã</span> Add JSON-LD Product schema to theme</div>
    <div class="chk"><span class="ic">üìã</span> Optimize product URL handles</div>
  </div>
</div>

</div><!-- /wrap -->

<script>
const API = window.location.origin + '/api/v1';
let metaData = null;
let shopifyData = null;

// ‚îÄ‚îÄ‚îÄ Tab switching ‚îÄ‚îÄ‚îÄ
document.querySelectorAll('.tab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
    tab.classList.add('active');
    document.getElementById('panel-' + tab.dataset.tab).classList.add('active');
  });
});

// ‚îÄ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ‚îÄ
const $ = id => document.getElementById(id);
const fmt = (n, d=2) => typeof n === 'number' ? n.toFixed(d) : '‚Äî';
const fmtK = n => n >= 1000 ? (n/1000).toFixed(1) + 'K' : (n || 0).toString();

function showError(msg) {
  const el = $('errBanner');
  el.textContent = msg;
  el.style.display = 'block';
  setTimeout(() => el.style.display = 'none', 10000);
}

function updateTime() {
  $('lastUpdate').textContent = 'Updated ' + new Date().toLocaleTimeString();
}

// ‚îÄ‚îÄ‚îÄ Health Check ‚îÄ‚îÄ‚îÄ
async function loadHealth() {
  try {
    const resp = await fetch(API.replace('/api/v1','') + '/health');
    const data = await resp.json();
    $('healthStatus').textContent = data.status === 'healthy' ? 'Live' : 'Degraded';
    $('versionPill').textContent = 'v' + data.version;
  } catch(e) {
    $('healthStatus').textContent = 'Offline';
  }
}

// ‚îÄ‚îÄ‚îÄ Meta Performance ‚îÄ‚îÄ‚îÄ
async function loadMeta() {
  try {
    const resp = await fetch(API + '/dashboard/meta-performance');
    metaData = await resp.json();
    const s = metaData.summary || {};
    const campaigns = metaData.campaigns || [];

    // Overview cards
    $('ov-spend').textContent = '$' + fmt(s.total_spend);
    $('ov-spend-note').textContent = campaigns.length + ' campaigns';
    $('ov-clicks').textContent = fmtK(s.total_clicks);
    $('ov-clicks-note').textContent = '$' + fmt(s.avg_cpc) + ' per click';
    $('ov-ctr').textContent = fmt(s.avg_ctr) + '%';
    $('ov-cpc').textContent = '$' + fmt(s.avg_cpc);
    $('ov-cpc-note').textContent = s.avg_cpc < 0.15 ? 'üî• Below $0.15 target' : 'Above target';

    // Meta tab cards
    $('m-spend').textContent = '$' + fmt(s.total_spend);
    $('m-impressions').textContent = fmtK(s.total_impressions);
    $('m-reach').textContent = fmtK(s.total_reach);
    $('m-clicks').textContent = s.total_clicks || 0;
    $('m-ctr').textContent = fmt(s.avg_ctr) + '%';
    $('m-cpc').textContent = '$' + fmt(s.avg_cpc);

    // Campaign rows
    let html = '';
    campaigns.forEach(c => {
      const isGood = c.cpc < 0.50;
      const signal = c.cpc < 0.20 ? '<span class="g">‚òÖ Star performer</span>' :
                     c.cpc < 0.50 ? '<span class="a">‚óè Acceptable</span>' :
                     '<span class="r">‚ñº Review / pause</span>';
      const statusColor = c.status === 'ACTIVE' ? 'g' : 'r';
      html += `<tr>
        <td style="max-width:250px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${c.name}</td>
        <td class="mono ${statusColor}">${c.status}</td>
        <td class="mono">$${fmt(c.spend)}</td>
        <td class="mono">${c.clicks}</td>
        <td class="mono ${c.ctr > 3 ? 'g' : c.ctr > 1 ? 'a' : 'r'}">${fmt(c.ctr)}%</td>
        <td class="mono ${c.cpc < 0.20 ? 'g' : c.cpc < 0.50 ? 'a' : 'r'}">$${fmt(c.cpc)}</td>
        <td>${signal}</td>
      </tr>`;
    });
    $('metaRows').innerHTML = html || '<tr><td colspan="7" style="color:var(--dim)">No campaigns found</td></tr>';

    // Meta insight
    const best = campaigns.reduce((a,b) => (a.ctr||0) > (b.ctr||0) ? a : b, {});
    const worst = campaigns.reduce((a,b) => (a.cpc||0) > (b.cpc||0) ? a : b, {});
    if (campaigns.length > 1) {
      const ins = $('metaInsight');
      ins.style.display = 'block';
      ins.className = worst.cpc > 0.50 ? 'ins warn' : 'ins good';
      ins.innerHTML = `<strong>Best performer:</strong> "${best.name}" at ${fmt(best.ctr)}% CTR, $${fmt(best.cpc)} CPC.` +
        (worst.cpc > 0.50 ? ` <strong>Watch:</strong> "${worst.name}" has $${fmt(worst.cpc)} CPC ‚Äî consider pausing if it doesn't improve in 3 days.` : '');
    }

    // Progress bars
    $('prog-meta').style.width = '100%';
    $('prog-meta').textContent = '100% ‚Äî Active & optimized';

  } catch(e) {
    $('metaRows').innerHTML = '<tr><td colspan="7" style="color:var(--red)">Failed to load Meta data. Check API connection.</td></tr>';
  }
}

// ‚îÄ‚îÄ‚îÄ Shopify ‚îÄ‚îÄ‚îÄ
async function loadShopify() {
  try {
    // Try health check first
    const healthResp = await fetch(API + '/shopify/health-check');
    if (healthResp.ok) {
      const health = await healthResp.json();
      shopifyData = health;

      $('sh-status').textContent = health.token_valid ? '‚óè Live' : '‚óã Down';
      $('sh-status').className = 'val ' + (health.token_valid ? 'g' : 'r');
      $('sh-store').textContent = health.store || '';

      const p = health.products || {};
      $('sh-products').textContent = p.total || '‚Äî';
      $('sh-products-note').textContent = `CRO: ${p.cro_coverage || '‚Äî'} | ${p.price_range || ''}`;
      $('ov-products').textContent = p.total || '‚Äî';
      $('ov-products-note').textContent = `CRO: ${p.cro_coverage || '‚Äî'}`;

      const c = health.collections || {};
      const colTotal = (c.smart||0) + (c.custom||0);
      $('sh-collections').textContent = colTotal;
      $('sh-collections-note').textContent = `${c.smart||0} smart, ${c.custom||0} custom`;
      $('ov-collections').textContent = colTotal;
      $('ov-collections-note').textContent = `${c.smart||0} smart, ${c.custom||0} custom`;

      const hrs = Math.round((health.token_expires_in || 0) / 3600);
      $('sh-token').textContent = hrs + 'h';
      $('sh-token-note').textContent = hrs > 2 ? 'Auto-refresh enabled' : 'Refreshing soon...';
      $('ov-token').textContent = hrs + 'h';
      $('ov-token').className = 'val ' + (hrs > 4 ? 'g' : hrs > 1 ? 'a' : 'r');
      $('ov-token-note').textContent = 'Token TTL';

      // Products
      $('seo-cro').textContent = p.cro_coverage || '‚Äî';
      $('seo-meta').textContent = (p.total||0) + '/' + (p.total||0);

      $('prog-products').style.width = '100%';
      $('prog-products').textContent = '100% ‚Äî ' + (p.cro_coverage||'') + ' products';
      $('prog-overall').style.width = '78%';
      $('prog-overall').textContent = '78% ‚Äî 18/23 items';
      $('prog-email').style.width = '33%';
      $('prog-email').textContent = '33% ‚Äî Forms pending';
      $('prog-tech').style.width = '80%';
      $('prog-tech').textContent = '80% ‚Äî JSON-LD pending';

      // Load product list
      loadProducts();
      loadBlogs();
    } else {
      // Shopify router not deployed yet ‚Äî show status
      $('sh-status').textContent = 'Pending';
      $('sh-status').className = 'val a';
      $('sh-store').textContent = 'Router deploying...';
      $('shopifyRows').innerHTML = '<tr><td colspan="4" style="color:var(--dim)">Shopify router not yet deployed. Waiting for AutoSEM v1.3.0.</td></tr>';

      // Set reasonable defaults from known data
      $('ov-products').textContent = '23';
      $('ov-products-note').textContent = 'CRO: 23/23';
      $('ov-collections').textContent = '6';
      $('ov-collections-note').textContent = '4 smart, 2 custom';
      $('ov-token').textContent = '‚Äî';
      $('ov-token').className = 'val a';
      $('ov-token-note').textContent = 'Router pending';
      $('seo-cro').textContent = '23/23';
      $('seo-meta').textContent = '23/23';

      $('prog-products').style.width = '100%';
      $('prog-products').textContent = '100% ‚Äî 23/23 products';
      $('prog-overall').style.width = '78%';
      $('prog-overall').textContent = '78% ‚Äî 18/23 items';
      $('prog-email').style.width = '33%';
      $('prog-email').textContent = '33% ‚Äî Forms pending';
      $('prog-tech').style.width = '80%';
      $('prog-tech').textContent = '80% ‚Äî JSON-LD pending';
    }
  } catch(e) {
    $('shopifyRows').innerHTML = '<tr><td colspan="4" style="color:var(--dim)">Shopify router not available. Deploy v1.3.0 to enable.</td></tr>';
    // Fallback defaults
    $('ov-products').textContent = '23';
    $('ov-products-note').textContent = 'CRO: 23/23';
    $('prog-overall').style.width = '78%';
    $('prog-overall').textContent = '78% ‚Äî 18/23 items';
    $('prog-products').style.width = '100%';
    $('prog-products').textContent = '100% ‚Äî 23/23';
  }
}

async function loadProducts() {
  try {
    const resp = await fetch(API + '/shopify/products');
    const data = await resp.json();
    const products = data.products || [];
    let html = '';
    products.forEach(p => {
      const descOk = p.has_description;
      html += `<tr>
        <td style="max-width:280px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${p.title}</td>
        <td class="mono">$${p.price}</td>
        <td class="${descOk?'g':'r'}">${descOk ? p.description_length + ' chars ‚úì' : '‚úó Missing'}</td>
        <td class="g">‚úì</td>
      </tr>`;
    });
    $('shopifyRows').innerHTML = html || '<tr><td colspan="4">No products</td></tr>';
  } catch(e) {}
}

async function loadBlogs() {
  try {
    const resp = await fetch(API + '/shopify/blog-posts');
    const data = await resp.json();
    const posts = data.posts || [];
    $('ov-blogs').textContent = posts.length;
    $('seo-blogs').textContent = posts.length;
    let html = '';
    posts.forEach(p => {
      const date = p.published_at ? new Date(p.published_at).toLocaleDateString() : 'Draft';
      html += `<tr>
        <td>${p.title}</td>
        <td class="mono">${date}</td>
        <td style="color:var(--dim)">${p.tags || '‚Äî'}</td>
      </tr>`;
    });
    $('blogRows').innerHTML = html || '<tr><td colspan="3">No posts</td></tr>';
  } catch(e) {
    $('ov-blogs').textContent = '6';
    $('seo-blogs').textContent = '6';
    $('blogRows').innerHTML = '<tr><td colspan="3" style="color:var(--dim)">Blog API not available yet</td></tr>';
  }
}

// ‚îÄ‚îÄ‚îÄ Actions ‚îÄ‚îÄ‚îÄ
async function syncMeta() {
  try {
    await fetch(API + '/dashboard/sync-meta', { method: 'POST' });
    loadMeta();
  } catch(e) { showError('Sync failed: ' + e.message); }
}

async function refreshToken() {
  try {
    const resp = await fetch(API + '/shopify/refresh-token', { method: 'POST' });
    const data = await resp.json();
    if (data.status === 'refreshed') {
      loadShopify();
    } else {
      showError('Token refresh failed: ' + (data.message || ''));
    }
  } catch(e) { showError('Token refresh failed: ' + e.message); }
}

// ‚îÄ‚îÄ‚îÄ Init ‚îÄ‚îÄ‚îÄ
async function refreshAll() {
  await Promise.all([loadHealth(), loadMeta(), loadShopify()]);
  updateTime();
}

refreshAll();
setInterval(refreshAll, 60000); // Auto-refresh every 60s
</script>
</body>
</html>
